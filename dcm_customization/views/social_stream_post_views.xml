<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <record id="social_stream_post_view_kanban" model="ir.ui.view">
        <field name="name">social.stream.post.view.kanban.inherit.bit</field>
        <field name="model">social.stream.post</field>
        <field name="inherit_id" ref="social.social_stream_post_view_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='stream_id']" position="after">
                <field name="create_uid"/>
                <field name="bit_post_likes"/>
                <field name="bit_post_comments"/>
                <field name="bit_post_share"/>

            </xpath>
            <xpath expr="//span[hasclass('o_social_stream_post_author_image')]" position="inside">
                <img class="o_kanban_image_inner_pic" t-if="record.create_uid.raw_value and record.media_type.raw_value === 'bit'" t-att-alt="record.create_uid.value" t-att-src="kanban_image('res.users', 'image_1920', record.create_uid.raw_value)"/>
            </xpath>
            <xpath expr="//div[hasclass('o_social_stream_post_message')]" position="inside">
                <div class="o_social_stream_post_bit_stats d-flex justify-content-around" t-if="record.media_type.raw_value === 'bit'">
                    <div class="d-flex justify-content-around o_social_bit_likes">
                        <div t-attf-class="pl-2 pr-3"
                            t-att-data-stream-id="record.stream_id.raw_value"
                            t-att-data-post-id="record.id.raw_value">
                            <i class="fa fa-heart" title="Likes"/>
                            <b class="o_social_kanban_likes_count" t-esc="record.bit_post_likes.raw_value !== '0' ? record.bit_post_likes.raw_value : ''"/>
                        </div>

                        <div class="o_social_bit_comments o_social_comments o_social_subtle_btn px-4"
                            t-att-data-stream-id="record.stream_id.raw_value"
                            t-att-data-post-id="record.id.raw_value"
                            t-att-data-bit-account-id="record.account_id.raw_value"
                            data-media-type="bit"
                            t-att-data-post-message="record.message.raw_value"
                            t-att-data-post-images="record.stream_post_image_urls.raw_value"
                            t-att-data-post-link="record.post_link.raw_value"
                            t-att-data-author-name="record.author_name.raw_value"
                            t-att-data-bit-profile-image-url="kanban_image('res.users', 'image_1920', record.create_uid.raw_value)"
                            t-att-data-author-link="record.author_link.raw_value"
                            t-att-data-published-date="record.published_date.value"
                            t-att-data-formatted-published-date="record.formatted_published_date.value"
                            t-att-data-link-url="record.link_url.raw_value"
                            t-att-data-link-image="record.link_image_url.raw_value"
                            t-att-data-link-title="record.link_title.raw_value"
                            t-att-data-link-description="record.link_description.raw_value">
                            <i class="fa fa-comments" title="Comments"/>
                            <b class="o_social_kanban_comments_count" t-esc="record.bit_post_comments.raw_value !== '0' ? record.bit_post_comments.raw_value : ''"/>
                        </div>
                    </div>

                    <div class="flex-grow-1 text-right text-muted">
                        <t t-esc="record.bit_post_share.value"/>
                        Shares
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[@t-if='has_attachments']" position="replace">
                <div t-if="has_attachments and record.media_type.raw_value != 'bit'"
                    class="o_social_stream_post_image d-flex mx-n3 overflow-hidden"
                    t-att-data-images="record.stream_post_image_urls.raw_value">
                    <t t-set="image_urls_json" t-value="JSON.parse(record.stream_post_image_urls.raw_value)"/>

                    <t t-foreach="image_urls_json.length > 2 ? image_urls_json.slice(0, 2) : image_urls_json" t-as="image_url">
                        <t t-if="image_url_index == 1 &amp; record.stream_post_image_ids.raw_value.length > 2">
                            <a class="o_social_stream_post_image_more position-relative d-flex ml-1" t-att-data-current-index="1">
                                <img class="o_social_stream_post_image_click" t-att-src="image_urls_json[1]" alt="Post Image" />
                                <div class="o_social_stream_post_image_more_overlay d-flex align-items-center h-100 w-100 text-white justify-content-center position-absolute h1 m-0" style="user-select: none;">
                                    +<t t-esc="image_urls_json.length - 2"/>
                                </div>
                            </a>
                        </t>
                        <img t-else="" class="o_social_stream_post_image_click" t-att-src="image_url" alt="Post Image" t-att-data-current-index="image_url_index" />
                    </t>
                </div>
                <div t-if="has_attachments and record.media_type.raw_value === 'bit'"
                    class="o_social_stream_post_image d-flex mx-n3 overflow-hidden"
                    t-att-data-images="record.stream_post_image_urls.raw_value">
                    <t t-set="image_urls_json" t-value="JSON.parse(record.stream_post_image_urls.raw_value)"/>

                    <t t-foreach="image_urls_json.length > 2 ? image_urls_json.slice(0, 2) : image_urls_json" t-as="image_url">
                        <t t-if="image_url_index == 1 &amp; record.stream_post_image_ids.raw_value.length > 2">
                            <a class="o_social_stream_post_image_more position-relative d-flex ml-1" >
                                <img t-attf-src="#{image_url['url']}" alt="Post Image" t-if="image_url.mimetype" style="width: 93% !important;"/>
                                <video width="200"  t-attf-src="#{image_url.url}" t-if="!image_url.mimetype" alt="Post Image" controls="controls" />
                                <div class="o_social_stream_post_image_more_overlay d-flex align-items-center h-100 w-100 text-white justify-content-center position-absolute h1 m-0" style="user-select: none;width: 93% !important;">
                                    +<t t-esc="image_urls_json.length - 2"/>
                                </div>
                            </a>
                        </t>
                        <t t-else="">
                            <video t-if="!image_url.mimetype"  width="200"  t-attf-src="#{image_url.url}" alt="Post Image" controls="controls"   t-att-data-current-index="image_url_index"/>
                            <img t-if="image_url.mimetype" t-attf-src="#{image_url.url}" alt="Post Image"/>
                        </t>
                    </t>
                </div>
            </xpath>
        </field>
    </record>

    <record id="social_stream_post_view_search_" model="ir.ui.view">
        <field name="name">social.stream.post.search</field>
        <field name="model">social.stream.post</field>
        <field name="inherit_id" ref="social.social_stream_post_view_search"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='search_my_streams']" position="replace">
                
            </xpath>
        </field>
    </record>
</data>
</odoo>
